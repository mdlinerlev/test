"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),landing=function(){var a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"setFieldsData",value:function setFieldsData(b){for(var c in this.config.fields){var d=this.config.fields[c];a.addFieldRecord(b,c,a.getElementValueBySelector(d))}}},{key:"mergeProperties",value:function mergeProperties(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b}},{key:"getLandingData",value:function getLandingData(){var b={formId:this.config.landingId,formFieldsData:[],options:{extendResponseWithExceptionType:!0}};return b.options=this.mergeProperties(b.options,this.config.options),this.setFieldsData(b),a.setCookiesData(b),b}},{key:"getExceptionHandlerName",value:function getExceptionHandlerName(b){return"on"+b+"Handler"}},{key:"getFunctionFromObject",value:function getFunctionFromObject(b,c){if(c&&b&&b in c){var d=c[b];if(a.jQuery.isFunction(d))return d}0}},{key:"getExceptionHandler",value:function getExceptionHandler(b){var c=this.getFunctionFromObject(this.getExceptionHandlerName(b),this.config);return c?c:(c=this.getFunctionFromObject(this.getExceptionHandlerName(b),this),c?c:void 0)}},{key:"callExceptionHandler",value:function callExceptionHandler(b){if(-1===b.resultCode){var c=this.getExceptionHandler(b.exceptionType);if(c)return c(b,this),!0}return!1}},{key:"onError",value:function onError(b,c,d){a.jQuery.isFunction(this.config.onError)&&this.config.onError(b,c,d)}},{key:"onComplete",value:function onComplete(b){a.jQuery.isFunction(this.config.onComplete)&&this.config.onComplete(b)}},{key:"onSuccess",value:function onSuccess(b){a.jQuery.isFunction(this.config.onSuccess)&&this.config.onSuccess(b)}},{key:"onSaveDuplicatedEntityExceptionHandler",value:function onSaveDuplicatedEntityExceptionHandler(b,c){c.redirect()}},{key:"onResponse",value:function onResponse(b){var c=b.SaveWebFormLeadDataResult||b.SaveWebFormObjectDataResult;if(c){var _d=a.parseResponse(c);this.callExceptionHandler(_d)||(this.config.onSuccess?this.onSuccess(_d):0===_d.resultCode&&this.config.redirectUrl&&this.redirect())}}},{key:"redirect",value:function redirect(){window.location.href=this.config.redirectUrl}},{key:"createObjectFromLanding",value:function createObjectFromLanding(b){this.config=b;var c={formData:this.getLandingData()};this.addContactRegistrationInfo(c.formData),a.jQuery.ajax({url:b.serviceUrl,type:"POST",data:JSON.stringify(c),contentType:"application/json; charset=UTF-8",async:!0,crossDomain:!0,error:this.onError.bind(this),success:this.onResponse.bind(this),complete:this.onComplete.bind(this)})}},{key:"addContactRegistrationInfo",value:function addContactRegistrationInfo(b){this.contactId.value&&b.formFieldsData.push(this.contactId),this.bulkEmailRecipientId.value&&b.formFieldsData.push(this.bulkEmailRecipientId)}},{key:"createLeadFromLanding",value:function createLeadFromLanding(b){return console.warn("Method \"createLeadFromLanding()\" is obsolete. Use \"createObjectFromLanding()\""),this.createObjectFromLanding(b)}},{key:"initLanding",value:function initLanding(b){if(!a.isIE())for(var c in b.fields){var d=a.getURLParameter(c.replace(".","_"));a.setElementValueBySelector(b.fields[c],d)}}},{key:"contactId",get:function get(){if(!this._contactId){var b=a.contactIdKey;this._contactId={name:b,value:a.getURLParameter(b)||a.getCookie(b)}}return this._contactId}},{key:"bulkEmailRecipientId",get:function get(){if(!this._bulkEmailRecipientId){var b=a.bulkEmailRecipientIdKey;this._bulkEmailRecipientId={name:b,value:a.getURLParameter(b)||a.getCookie(b)}}return this._bulkEmailRecipientId}},{key:"config",get:function get(){if(!this._config)throw Error("Config not found");return this._config},set:function set(b){this._config=b}}],[{key:"$",value:function $(){if(!window.jQuery)throw Error("jQuery not found");return window.jQuery.apply(window.jQuery,arguments)}},{key:"addFieldRecord",value:function addFieldRecord(b,c,d){b.formFieldsData.push({name:c,value:d})}},{key:"parseResponse",value:function parseResponse(b){return b=b.replace("resultCode","\"resultCode\""),b=b.replace("resultMessage","\"resultMessage\""),b=b.replace("exceptionType","\"exceptionType\""),b=b.replace("optionResult","\"optionResult\""),JSON.parse(b)}},{key:"getCookie",value:function getCookie(b){if(!b)return"";var c=new RegExp("(?:(?:^|.*;)\\s*"+b+"\\s*\\=\\s*([^;]*).*$)|^.*$");return a.cookie.replace(c,"$1")||""}},{key:"getCorrectCookiesName",value:function getCorrectCookiesName(b){return{BpmRef:"bpmRef",BpmHref:"bpmHref",BpmSessionId:"bpmTrackingId"}[b]}},{key:"setCookiesData",value:function setCookiesData(b){for(var _arr=["BpmRef","BpmHref","BpmSessionId"],_i=0;_i<_arr.length;_i++){var c=_arr[_i],d=a.getCorrectCookiesName(c),e=a.getCookie(d);e&&a.addFieldRecord(b,c,e)}}},{key:"getElementValueBySelector",value:function getElementValueBySelector(b){var c=a.$(b)[0];return c?a.$(c).is(":checkbox")?a.$(c).prop("checked"):a.$(c).val():""}},{key:"setElementValueBySelector",value:function setElementValueBySelector(b,c){var d=a.$(b)[0];d&&a.$(d).val(c)}},{key:"getURLParameter",value:function getURLParameter(b){return decodeURIComponent((RegExp("[?|&]"+b+"=(.+?)(&|$)","i").exec(a.getLocationSearch())||[,""])[1])}},{key:"getLocationSearch",value:function getLocationSearch(){return location.search}},{key:"isIE",value:function isIE(){return /msie|trident/i.test(window.navigator.userAgent)}},{key:"contactIdKey",get:function get(){return"ContactId"}},{key:"bulkEmailRecipientIdKey",get:function get(){return"BulkEmailRecipientId"}},{key:"cookieExpireDays",get:function get(){return 7}},{key:"cookie",get:function get(){return document.cookie}},{key:"jQuery",get:function get(){if(!window.jQuery)throw Error("jQuery not found");return window.jQuery}}]),a}();return new a(window.$)}();